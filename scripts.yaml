####################################################
############### Functional Scripts #################
####################################################
correct_objects_values:
  sequence:
    - service: mqtt.publish
      data:
        topic: "smarthome/mqtt_client/status_update"
        payload: "Offline"
    - service: group.set_visibility
      data_template:
        entity_id: group.living_room_ac_hidden_controls
        visible: "{%if (states.input_boolean.lr_ac_status.state == 'on')%}true{%else%}false{%endif%}"
    - service: input_text.set_value
      data_template:
        entity_id: input_text.lr_ac_temp_text
        value: "{%if states.input_text.lr_ac_temp_text.state != 'unknown' %}{{ states.input_text.lr_ac_temp_text.state }}{%else%}30{%endif%}"
    - service: input_text.set_value
      data_template:
        entity_id: input_text.shabbat_notify_minutes_start
        value: "{%if states.input_text.shabbat_notify_minutes_start.state != 'unknown' %}{{ states.input_text.shabbat_notify_minutes_start.state }}{%else%}15{%endif%}"
    - service: input_number.set_value
      data_template:
        entity_id: input_number.nursery_ambiance_color_temperature
        value: "{% if states.light.nursery_main_light.attributes.color_temp %}{{ states.light.nursery_main_light.attributes.color_temp }}{%else%}153{%endif%}"
    - service: input_number.set_value
      data_template:
        entity_id: input_number.nursery_lightstrip_brightness
        value: "{% if states.light.nursery_dresser_light.attributes.brightness %}{{ states.light.nursery_dresser_light.attributes.brightness }}{%else%}0{%endif%}"
    - service: input_number.set_value
      data_template:
        entity_id: input_number.nursery_bloom_brightness
        value: "{% if states.light.nursery_chair_light.attributes.brightness %}{{ states.light.nursery_chair_light.attributes.brightness }}{%else%}0{%endif%}"
    - service: script.turn_on
      data:
        entity_id: script.sync_nursery_ac_entities
    - service: script.turn_on
      data:
        entity_id: script.sync_bedroom_ac_entities
    - service: script.turn_on
      data:
        entity_id: script.sync_living_room_ac_entities

get_workstation_mqtt_client_status:
  sequence:
    - service: mqtt.publish
      data:
        topic: "smarthome/mqtt_client/askmypc_action"
        payload: "request_status_update"

office_rm_mini_send_packet:
  sequence:
    - service: switch.broadlink_send_packet_192_168_0_133
      data_template:
        packet:
          - '{{ packet_code }}'

get_sensors_report_notificiation_from_leaving_home:
  sequence:
    - service: script.send_sensors_report_notification
      data:
        destination: "everyone"
        notification_title: "Leaving Home Scenario Initiated"

get_sensors_report_notificiation_from_ui:
  sequence:
    - service: script.send_sensors_report_notification
      data:
        destination: "everyone"
        notification_title: "Report Request From UI"

get_sensors_report_notificiation_from_alexa:
  sequence:
    - service: script.send_sensors_report_notification
      data_template:
        destination: >
          {% if (send_to.lower() == 'tomer') or (send_to.lower() == 'my husband') %}tomer
          {% elif (send_to.lower() == 'hava') or (send_to.lower() == 'my wife') %}hava
          {% else %}everyone
          {% endif %}
        notification_title: "Report Request From Alexa"
        
send_sensors_report_notification:
  sequence:
    - service_template: >
        {% if destination.lower() == 'tomer' %}notify.telegram_tomer_service
        {% elif destination.lower() == 'hava' %}notify.telegram_hava_service
        {% else %}notify.everyone
        {% endif %}
      data_template:
        message: >
          {% for sensor_name in states.group.all_s1c_sensors.attributes.entity_id %}{% set sensor_name = sensor_name.replace('sensor.', '') %}
          
          {{ states.sensor[sensor_name].attributes.friendly_name }} is {{ states.sensor[sensor_name].state }}
          {% endfor %}
        title: '{{ notification_title }}'

run_speed_test:
  sequence:
    - service: sensor.update_speedtest
    
alexa_restart_hass:
  sequence:
    - service: notify.telegram_tomer_service
      data:
        message: "Restart Home Assistant was requested by alexa."
        title: "System Restart Initiated"
    - service: homeassistant.restart

check_last_recorder_session:
  sequence:
    - service: notify.telegram_tomer_service
      data:
        message: "Last ended session end status was {{ states.sensor.last_recorder_status.state }}"
        title: "Recorder"

####################################################
################ Office fan Scripts ################
####################################################    
set_office_ceiling_fan_timer_1h:
  sequence:
    - service: script.office_rm_mini_send_packet
      data:
        packet_code: "JgA2ASoNKg0OKQ4pDSoNKg4pDigPKA4pDygOAAEFKA8pDgwrDCsMKycQJxAnECcPKA8oDyrpKg0oDwwrDCsMKwwrJxAMKwwrDCsMKwwAAQYoDygPDCsMKwwrDCsoDwwrDCsMKwwrDAABBycQJxAMKwwqDSoNKigPDCsOKQwrDCsMAAEHKA8nEAwrDCsMKw4pJxAOKQwrDCsMKg8AAQQoDygPDCsMKwwrDikoDwwrDCsMKw4pDAABBioNKA8NKg4pDCsMKygPDCsMKwwrDCsMAAEHJxAnEAwrDCsMKwwrJw8NKg0qDSoOKQ4AAQUpDikMDyoNKg0qDikoDBEpDikOKQ4oDwABBCoLLA0OKQ4pDikOKSoNDikOKQ4pDikOAAEEKg0qDQ8oDygOKQ4pKg0OKQ4pDikOKQ4ADQUAAA=="

set_office_ceiling_fan_timer_3h:
  sequence:
    - service: script.office_rm_mini_send_packet
      data:
        packet_code: "JgA2AScQJxAMKwwrDSoOKA8oDygOKQ4pDCsMAAEHKA8oDwwrDCsMKycQJxAnECcQJw8oDyjrKA8oDwwrDCsMKygPDCsMKwwrJxAnEAwAAQYoDygPDCsMKwwrKA8MKwwrDCsoDygPDAABBycQKQ4MKwwrDCooDw0qDSoMKygPKg0MAAEHKg0pDg4pDikOKSkODikOKQ4pKQ4pDgwAAQYqDSoNDikMKwwrKA8OKQ4pDikpDigPDgABBSkOKQ4MKw4oDikqDQ0qDikOKSgPKg0MAAEHKQ4oDw4pDikOKSkODikOKQ0qKQ0oDw4AAQUpDioNDCsOKQ4pKQ4OKQ4pDikpDikODgABBCoNKg0MKw4pDikqDQwrDCsOKScQJxAMAAEGKA8oDwwrDCsMKygPDCsMKwwrJxAnEAwADQUAAA=="
        
set_office_ceiling_fan_timer_6h:
  sequence:
    - service: script.office_rm_mini_send_packet
      data:
        packet_code: "JgBqASgPKA8NKgwrDCsMKwwrDCsMKwwrDCsMAAEHJxAoDwwqDCsNKikOKA8oDygPKQ4oDyjrJxAnEAwqDSoOKQ4pDCsMKw0qDSopDgwAAQcnECcQDSoMKwwrDSkOKQwrDCsNKigPDAABBykOKQ4MKw4pDSoMKwwqDikOKQwrKQ4MAAEHKA8nEAwrDCsMKwwrDCsMKwwrDCooDw0AAQYoDygPDSoMKwwrDCsOKQ0qDSoNKigPDgABBCoNKg0PKA8oDikOKQ4pDikOKQ4pKg0OAAEEKg4pDg4oDygPKA8oDygPKA8oDikqDQ4AAQUqDCsMDykOKQ4oDygPKA8oDygPKCoNDwABBCoNKg0OKQ4pDikOKQ4pDigPKA8oKg0PAAEEKg0qDQ4pDikOKQ4pDikOKQ4pDikpDg4AAQQqDSoLECkOKQ4pDikOKQ4pDikOKSkODgABBCoNKg0PKA4pDikOKQ4pDikOKQ4pKQ4OAA0FAAAAAAAAAAAAAAAAAAA="

####################################################
################## Scenes Scripts ##################
####################################################    
leaving_home:
  sequence:
    - service: remote.turn_off
      entity_id: remote.living_room_harmony_hub
    - service: input_boolean.turn_off
      entity_id: input_boolean.lr_ac_status
    - service: light.turn_off
      entity_id: light.tv_lights
    - service: switch.turn_on
      entity_id: switch.kitchen_main_light
    - delay:
        milliseconds: 1500
    - service: light.turn_off
      entity_id: light.living_room_night_light
    - service: switch.turn_off
      entity_id: switch.living_room_main_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.kitchen_bar_light
    - service: switch.turn_off
      entity_id: switch.entrance_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.bedroom_main_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.small_bathroom_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.kitchen_island_light
    - delay:
        milliseconds: 1500
    - service: switch.turn_off
      entity_id: switch.service_room_light
    - service: switch.turn_off
      entity_id: switch.closet_room_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.small_hallway_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.shower_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.main_bathroom_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.guest_room_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.living_room_small_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.balcony_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.main_hallway_light
    - service: switch.turn_off
      entity_id: switch.office_light

      
sleep_time:
  sequence:
    - service: media_player.turn_on
      entity_id: media_player.bedroom_tv
    - service: switch.turn_on
      entity_id: switch.kitchen_island_light
    - delay:
        milliseconds: 1500
    - service: switch.turn_off
      entity_id: light.living_room_night_light
    - service: switch.turn_off
      entity_id: switch.living_room_main_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.kitchen_bar_light
    - service: switch.turn_off
      entity_id: switch.entrance_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.bedroom_main_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.small_bathroom_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.kitchen_main_light
    - delay:
        milliseconds: 1500
    - service: switch.turn_off
      entity_id: switch.service_room_light
    - service: switch.turn_off
      entity_id: switch.closet_room_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.small_hallway_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.shower_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.main_bathroom_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.guest_room_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.living_room_small_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.balcony_light
    - delay:
        milliseconds: 500
    - service: switch.turn_off
      entity_id: switch.main_hallway_light
    - service: light.turn_off
      entity_id: light.tv_lights
    - service: remote.turn_off
      entity_id: remote.living_room_harmony_hub
    - delay:
        seconds: 10
    - service: script.bedroom_tv_set_timer
      data_template:
        minutes: '90'
    - service: switch.turn_off
      entity_id: switch.office_light
    - service: input_boolean.turn_off
      entity_id: input_boolean.lr_ac_status
    - service: switch.turn_on
      entity_id: switch.kitchen_island_light
    - delay:
        minutes: 5
    - service: switch.turn_off
      entity_id: switch.kitchen_island_light
      
####################################################
############# Device Tracker Scripts ###############
####################################################
update_all_devices:
  sequence:
    - service: script.update_hava_devices
    - service: script.update_tomer_devices

update_hava_devices:
  sequence:
    - service: mqtt.publish
      data:
        topic: "owntracks/havaphone/hpowntracks/cmd"
        payload: '{"_type":"cmd","action":"reportLocation"}'
        qos: 2
#    - service: mqtt.publish
#      data:
#        topic: "owntracks/havaphone/hpowntracks/cmd"
#        payload: '{"_type":"cmd","action":"waypoints"}'
#        qos: 2

update_tomer_devices:
  sequence:
    - service: mqtt.publish
      data:
        topic: "owntracks/tomerphone/tpowntracks/cmd"
        payload: '{"_type":"cmd","action":"reportLocation"}'
        qos: 2
#    - service: mqtt.publish
#      data:
#        topic: "owntracks/tomerphone/tpowntracks/cmd"
#        payload: '{"_type":"cmd","action":"waypoints"}'
#        qos: 2

####################################################
################## Switcher AIO ####################
####################################################
turn_on_boiler_15_min:
  sequence:
    - service: input_select.select_option
      data:
        entity_id: switcher_aio.timer_minutes_input_select
        option: "15"
    - service: script.turn_on
      data:
        entity_id: switcher_aio.turn_on_timer_script
        
turn_on_boiler_30_min:
  sequence:
    - service: input_select.select_option
      data:
        entity_id: switcher_aio.timer_minutes_input_select
        option: "30"
    - service: script.turn_on
      data:
        entity_id: switcher_aio.turn_on_timer_script
        
turn_on_boiler_45_min:
  sequence:
    - service: input_select.select_option
      data:
        entity_id: switcher_aio.timer_minutes_input_select
        option: "45"
    - service: script.turn_on
      data:
        entity_id: switcher_aio.turn_on_timer_script
        
turn_on_boiler_60_min:
  sequence:
    - service: input_select.select_option
      data:
        entity_id: switcher_aio.timer_minutes_input_select
        option: "60"
    - service: script.turn_on
      data:
        entity_id: switcher_aio.turn_on_timer_script

###################################
##### OpenMqttGateway Scripts #####
###################################
ring_the_doorbell:
  sequence:
    - service: mqtt.publish
      data:
        topic: "omg/rfgw_hallway/commands/PLSL_450/433_1/RFBITS_24"
        payload: "14878223"
